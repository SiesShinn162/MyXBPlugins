const laisuat = 0.015
const timeIM = 6000
import { join  , resolve } from 'path';
import { existsSync , writeFileSync , readFileSync } from "fs";
import moment from "moment-timezone";
const config = {
    name: "sbank",
    aliases: ["sbv1"],
    description: "1 cÃ¡i ngÃ¢n hÃ ng nho nhá»!",
    usage: "dÃ¹ng Ä‘i rá»“i biáº¿t Ã¡",
    cooldown: 3,
    permissions: [0, 1, 2],
    isAbsolute: false,
    isHidden: false,
    credits: "Sies",
    
}


async function onCall({ message, args, getLang, extra, data, userPermissions, prefix }) {
    // Do something
  try{
    const {  senderID , threadID, messageID, send, reply, react } = message;
  const PATH = join(global.assetsPath, 'bank.json');
  const img = reader(join(global.assetsPath, 'anhbank.jpg'));
  const { Users } = global.controllers;
  var timeNow = moment.tz("Asia/Ho_Chi_Minh").format("HH:mm:ss");    
  console.log(timeNow)
  var seconds = moment.tz("Asia/Ho_Chi_Minh").format("ss");
  if (!existsSync(PATH)) return writeFileSync(PATH, "[]", "utf-8");
  const user = (args.slice(1, args.length)).join(" ");
  var dataJson = JSON.parse(readFileSync(PATH, "utf-8"));
  var userData = dataJson.find(item => item.senderID == message.senderID) || { senderID: senderID,  money: 0 };
  const moneyInput = parseInt(args[1])
  if(args[0] == '-r' || args[0] == 'dangki') {
        if (!dataJson.some(i => i.senderID == message.senderID)) {
        dataJson.push(userData);
        writeFileSync(PATH, JSON.stringify(dataJson, null, 4), "utf-8");
  return message.reply(`[ SIES-NOTI ] Â» Báº¡n Ä‘Ã£ Ä‘Äƒng kÃ­ thÃ nh cÃ´ng, gá»­i Ã­t nháº¥t 5000$ Ä‘á»ƒ cÃ³ lÃ£iğŸ’°`)}
        else return message.reply(`[ SIES-NOTI ] Â» Báº¡n Ä‘Ã£ cÃ³ tÃ i khoáº£n trÃªn há»‡ thá»‘ng Sies Bank !`);
}
        
  if(args[0] == 'check' || args[0] == 'vÃ­') {
    if (dataJson.some(i => i.senderID == senderID) == false) return message.reply(`[ SIES-NOTI ] Â» Báº¡n khÃ´ng cÃ³ tÃ i khoáº£n trÃªn há»‡ thá»‘ng Sies Bank , hÃ£y Ä‘Äƒng kÃ­!`);
    else {
       var userMoney = userData.money;
       return message.reply(`[ SIES-NOTI ] Â» Sá»‘ tiá»n báº¡n Ä‘ang gá»­i trong Sies Bank lÃ : ${userMoney}$\nğŸ’· LÃ£i: +${laisuat}% trong ${timeIM/60} phÃºt`)
    }
  }
  if(args[0] == 'gá»­i' || args[0] == 'send') {
    if (!args[1] || isNaN(args[1]) || parseInt(args[1]) < 5000) return message.reply("[ SIES-NOTI ] Â» Sá»‘ tiá»n cáº§n gá»­i pháº£i lÃ  1 con sá»‘ vÃ  lá»›n hÆ¡n 5000$ğŸ’°")
    if (!dataJson.some(i => i.senderID == senderID)) {
        return message.reply(`[ SIES-NOTI ] Â» Báº¡n khÃ´ng cÃ³ tÃ i khoáº£n trÃªn há»‡ thá»‘ng Sies Bank, hÃ£y Ä‘Äƒng kÃ­!`);
    }
    else { 
        console.log(userData);
        console.log(userData.money)
        const moneyy = await Users.getMoney(message.senderID);
        if(moneyy < moneyInput) return message.reply(`[ SIES-NOTI ] Â» Sá»‘ dÆ° khÃ´ng Ä‘á»§ ${moneyInput} Ä‘á»ƒ gá»­i vÃ o Sies BankğŸ’° `)
        var money = userData.money;
        userData.money = parseInt(money) + parseInt(moneyInput);
        writeFileSync(PATH, JSON.stringify(dataJson, null, 4), "utf-8");
        await Users.decreaseMoney(message.senderID, parseInt(moneyInput))
        return message.reply(`[ SIES-NOTI ] Â» Báº¡n Ä‘Ã£ gá»­i ${moneyInput}$ vÃ o Sies Bank\nğŸ’· LÃ£i: +${laisuat}% trong ${timeIM/60} phÃºt`)
        }
    }
  if(args[0] == 'rÃºt' || args[0] == 'láº¥y') { 
        if (!args[1] || isNaN(args[1]) || parseInt(args[1]) < 5000) return message.reply("[ SIES-NOTI ] Â» Sá»‘ tiá»n cáº§n rÃºt pháº£i lÃ  1 con sá»‘ vÃ  lá»›n hÆ¡n 50$");
        if (!dataJson.some(i => i.senderID == senderID)) {
        return message.reply('[ SIES-NOTI ] Â» NgÆ°á»i dÃ¹ng chÆ°a Ä‘Äƒng kÃ­ sá»­ dá»¥ng banking, banking register Ä‘á»ƒ Ä‘Äƒng kÃ­')
        }
    else {  
        
        var money = userData.money;
        if(parseInt(money) < parseInt(moneyInput)) return message.reply('[ SIES-NOTI ] Â» Sá»‘ dÆ° cá»§a báº¡n khÃ´ng Ä‘á»§ Ä‘á»ƒ thá»±c hiá»‡n giao dá»‹ch nÃ y!')
        else {
            await Users.increaseMoney(message.senderID, parseInt(moneyInput))
            userData.money = parseInt(money) - parseInt(moneyInput)
            writeFileSync(PATH, JSON.stringify(dataJson, null, 4), "utf-8");
            return message.reply(`[ SIES-NOTI ] Â» RÃºt thÃ nh cÃ´ng ${parseInt(moneyInput)}$, sá»‘ dÆ° cÃ²n láº¡i lÃ  : ${parseInt(money) - parseInt(moneyInput)}$`)
        }
        }
    }
  else {
    var msg = {body: `=====ğ’ğ¢ğğ¬ ğğšğ§ğ¤ğŸ¦=====\n\n=Â»ChÃ o má»«ng tá»›i há»‡ thá»‘ng ğ’ğ¢ğğ¬ ğğšğ§ğ¤ cá»§a chÃºng tÃ´i! , Táº¡i Ä‘Ã¢y chÃºng tÃ´i cÃ³ cÃ¡c dá»‹ch vá»¥:\n\n=Â» 1.[-r/register] - ÄÄƒng kÃ­ gá»­i tiá»n táº¡i ğ’ğ¢ğğ¬ ğğšğ§ğ¤ğŸ’¹\n=Â» 2.[check/vÃ­] - Xem sá»‘ tiá»n trong ğ’ğ¢ğğ¬ ğğšğ§ğ¤ğŸ’³\n=Â» 3.[gá»­i/send] - Gá»­i tiá»n vÃ o ğ’ğ¢ğğ¬ ğğšğ§ğ¤ğŸ’·\n=Â» 4.[rÃºt] - RÃºt tiá»n tá»« ğ’ğ¢ğğ¬ ğğšğ§ğ¤ğŸ’°\n\nğŸ’²==Â» LÃ£i suáº¥t hiá»‡n táº¡i cá»§a báº¡n: +${laisuat}% trong ${timeIM/60} phÃºt` , attachment: img}
    return message.send(msg)}
  
  }catch(e){
    message.send("Error :" , e); 
    console.error(e);}
  


}


export default {
    config,
    onCall
}

// or
// export {
//     config,
//     langData,
//     onCall
// }
